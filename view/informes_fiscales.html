{include="header"}
<!--
Copyright (C) 2015 joenilson

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<div class="container-fluid" style="margin-top: -10px;">
    <div class="row">
        <div class="col-sm-12 text-right">
            <div class="col-sm-10 text-left">
                <h2>
                    <span class="fa fa-stack-overflow"></span>&nbsp;Informes Fiscales DGII
                    <a class="btn btn-sm btn-default" href="{$fsc->url()}" title="Recargar la página">
                        <span class="glyphicon glyphicon-refresh"></span>
                    </a>
                    {if="$fsc->page->is_default()"}
                    <a class="btn btn-sm btn-default active" href="{$fsc->url()}&amp;default_page=FALSE" title="desmarcar como página de inicio">
                        <span class="glyphicon glyphicon-home"></span>
                    </a>
                    {else}
                    <a class="btn btn-sm btn-default" href="{$fsc->url()}&amp;default_page=TRUE" title="marcar como página de inicio">
                        <span class="glyphicon glyphicon-home"></span>
                    </a>
                    {/if}
                    <span class="btn-group">
                        <a class="btn btn-sm btn-default" href="index.php?page=ncf" title="Ir al Maestro de NCF">
                            <span class="fa fa-list-ol"></span>&nbsp;Maestro de NCF
                        </a>
                        {loop="$fsc->extensions"}
                            {if="$value->type=='button'"}
                                <a href="index.php?page={$value->from}{$value->params}" class="btn btn-sm btn-default">{$value->text}</a>
                            {/if}
                        {/loop}
                    </span>
                    <button id="ayuda-informes-fiscales" type="button" class="btn btn-sm btn-info"><i class="fa fa-question-circle fa-lg"></i></button>
                </h2>
                <p align="left">Por favor, primero elija el reporte que desea procesar y luegue seleccione el rango de fechas y si tiene multiples almacenes elige uno y proceda a darle click al boton <b>Generar Informaci&oacute;n</b></p>
            </div>
            <div class="col-sm-2 text-right">

            </div>

        </div>
    </div>
</div>
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-2 col-md-2 col-sm-3">
            <ul class="nav nav-pills nav-stacked" role="tablist">
                <li role="presentation" {if="$fsc->reporte=='reporte-consolidado'"}class="active"{/if}>
                    <a href="#reporte-consolidado" aria-controls="reporte-consolidado" role="tab" data-toggle="tab" onclick="seleccionar('reporte-consolidado');">
                        <span class="glyphicon glyphicon-book"></span> &nbsp; Reporte Consolidado
                    </a>
                </li>
                <li role="presentation" {if="$fsc->reporte=='reporte-ventas'"}class="active"{/if}>
                    <a href="#reporte-ventas" aria-controls="reporte-ventas" role="tab" data-toggle="tab" onclick="seleccionar('reporte-ventas');">
                        <span class="glyphicon glyphicon-book"></span> &nbsp; Reporte de Ventas
                    </a>
                </li>
                <li role="presentation" {if="$fsc->reporte=='detalle-ventas'"}class="active"{/if}>
                    <a href="#detalle-ventas" aria-controls="detalle-ventas" role="tab" data-toggle="tab" onclick="seleccionar('detalle-ventas');">
                        <span class="glyphicon glyphicon-book"></span> &nbsp; Detalle de Ventas
                    </a>
                </li>
                <li role="presentation" {if="$fsc->reporte=='detalle-ventas-agente'"}class="active"{/if}>
                    <a href="#detalle-ventas-agente" aria-controls="detalle-ventas" role="tab" data-toggle="tab" onclick="seleccionar('detalle-ventas-agente');">
                        <span class="glyphicon glyphicon-book"></span> &nbsp; Detalle Ventas por Vendedor
                    </a>
                </li>                
                <li role="presentation" {if="$fsc->reporte=='resumen-ventas'"}class="active"{/if}>
                    <a href="#resumen-ventas" aria-controls="resumen-ventas" role="tab" data-toggle="tab" onclick="seleccionar('resumen-ventas');">
                        <span class="glyphicon glyphicon-book"></span> &nbsp; Resumen de Ventas
                    </a>
                </li>
                <li role="presentation" {if="$fsc->reporte=='reporte-compras'"}class="active"{/if}>
                    <a href="#reporte-compras" aria-controls="reporte-compras" role="tab" data-toggle="tab" onclick="seleccionar('reporte-compras');">
                        <span class="glyphicon glyphicon-book"></span> &nbsp; Reporte de Compras
                    </a>
                </li>
                <li role="presentation" {if="$fsc->reporte=='detalle-compras'"}class="active"{/if}>
                    <a href="#detalle-compras" aria-controls="detalle-compras" role="tab" data-toggle="tab" onclick="seleccionar('detalle-compras');">
                        <span class="glyphicon glyphicon-book"></span> &nbsp; Detalle de Compras
                    </a>
                </li>
                <li role="presentation" {if="$fsc->reporte=='reporte-606'"}class="active"{/if}>
                    <a href="#reporte-606" aria-controls="reporte-606" role="tab" data-toggle="tab" onclick="seleccionar('reporte-606');">
                        <span class="glyphicon glyphicon-book"></span> &nbsp; Reporte 606
                    </a>
                </li>
                <li role="presentation" {if="$fsc->reporte=='reporte-607'"}class="active"{/if}>
                    <a href="#reporte-607" aria-controls="reporte-607" role="tab" data-toggle="tab" onclick="seleccionar('reporte-607');">
                        <span class="glyphicon glyphicon-book"></span> &nbsp; Reporte 607
                    </a>
                </li>
                <li role="presentation" {if="$fsc->reporte=='reporte-608'"}class="active"{/if}>
                    <a href="#reporte-608" aria-controls="reporte-608" role="tab" data-toggle="tab" onclick="seleccionar('reporte-608');">
                        <span class="glyphicon glyphicon-book"></span> &nbsp; Reporte 608
                    </a>
                </li>
            </ul>
      </div>
      <div class="col-lg-10 col-md-10 col-sm-9">
         <form name="f_informes_fiscales" id="f_informes_fiscales" class="form-inline" method="POST" action='{$fsc->url()}'>
            <input type="hidden" name="tipo-reporte" id="tipo-reporte" value='{$fsc->reporte}'>
            <label for='inicio'><b>Fecha Inicio</b></label>
            <input type="text" class="form-control input-sm datepicker" name='inicio' id="inicio">
            <label for='fin'><b>Fecha Fin</b></label>
            <input type="text" class="form-control input-sm datepicker" name="fin" id="fin">
            <select class="form-control col-sm-3 input-sm selectpicker" multiple='' name="codalmacen[]" required='' id="codalmacen" data-style="btn-default btn-sm" data-actions-box="true">
            {loop="$fsc->almacenes->all()"}
                <option value="{$value->codalmacen}" {if="in_array($value->codalmacen,$fsc->almacenes_seleccionados)"}selected{/if}>{$value->nombre}</option>
            {/loop}
            </select>
            <div class='btn-group'>
                <button class="btn btn-default btn-sm" type="submit" name="buscar">Generar Informaci&oacute;n</button>
                {if="$fsc->archivoXLSXPath"}
                <a class="btn btn-success btn-sm" role="button" href="{$fsc->archivoXLSXPath}">Descargar Informaci&oacute;n</a>
                {/if}
            </div>
         </form>
      </div>
      <div class="col-lg-10 col-md-10 col-sm-9">
          <div class="row">
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane {if="$fsc->reporte=='reporte-consolidado'"}active{/if}" id="reporte-consolidado">
                    <div class='col-sm-3'>
                        <table class="table table-responsive" style="margin-top: 30px;">
                            <thead>
                                <tr>
                                    <th colspan="2" class='text-center'>Resumen de Ingresos y Salidas</th>
                                </tr>
                                <tr>
                                    <th>Tipo</th>
                                    <th>Monto</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Ventas Realizadas</td>
                                    <td class="text-right">{$fsc->show_numero($fsc->sumaVentas)}</td>
                                </tr>
                                <tr>
                                    <td>Compras Realizadas</td>
                                    <td class="text-right">{$fsc->show_numero($fsc->sumaCompras)}</td>
                                </tr>
                                <tr style="font-weight: bold;">
                                    <td>Saldo del Periodo</td>
                                    <td class="text-right">{$fsc->show_numero($fsc->saldoConsolidado)}</td>
                                </tr>
                                <tr>
                                    <td>Ventas Cobradas</td>
                                    <td class="text-right">{$fsc->show_numero($fsc->sumaVentasPagadas)}</td>
                                </tr>
                                <tr>
                                    <td>Compras Pagadas</td>
                                    <td class="text-right">{$fsc->show_numero($fsc->sumaComprasPagadas)}</td>
                                </tr>
                                <tr style="font-weight: bold;">
                                    <td>Saldo Neto del Periodo</td>
                                    <td class="text-right">{$fsc->show_numero($fsc->saldoConsolidadoPagadas)}</td>
                                </tr>
                                {if="$fsc->total_forma_pago"}
                                <tr>
                                    <td class="text-center" colspan="2"><strong>Ingresos por Forma de Pago</strong></td>
                                </tr>
                                {/if}
                                <!-- {$total_consolidado_venta = 0;} !-->
                                {loop="$fsc->total_forma_pago"}
                                <tr>
                                    <td><strong>{$value->codpago}</strong></td>
                                    <td class="text-right">{$fsc->show_numero($value->total)}</td>
                                    <!-- {$total_consolidado_venta += $value->total; } !-->
                                </tr>
                                {/loop}
                                {if="$fsc->total_forma_pago"}
                                <tr>
                                    <td><strong>Total Formas Pago</strong></td>
                                    <td class="text-right"><strong>{$fsc->show_numero($total_consolidado_venta)}</strong></td>
                                </tr>
                                {/if}
                            </tbody>
                        </table>
                    </div>
                    <div class='col-sm-9'>
                        <table id="table-reporte-consolidado"
                               data-mobile-responsive="true"
                               data-toggle="table"
                               data-method="POST"
                               data-height="500"
                               data-search="false"
                               {if="$fsc->reporte=='reporte-consolidado'"}data-ajax="buscarInformacion"{/if}
                               data-pagination="true"
                               data-page-size="100"
                               data-page-list="[100,150,200,250,500]"
                               data-show-footer="false"
                               data-show-refresh="true"
                               data-side-pagination="server">
                            <thead>
                                <tr>
                                    <th data-sortable="true" data-field="tipo">Tipo</th>
                                    <th data-sortable="true" data-field="codalmacen">Almacén</th>
                                    <th data-sortable="true" data-field="fecha">Fecha</th>
                                    <th data-sortable="true" data-field="nombre">Entidad</th>
                                    <th data-sortable="true" data-field="ncf">NCF</th>
                                    <th data-sortable="true" data-falign="right" data-align="right" data-formatter="numberFormatter" data-field="neto">Neto</th>
                                    <th data-sortable="true" data-falign="right" data-align="right" data-formatter="numberFormatter" data-field="totaliva">{#FS_IVA#}</th>
                                    <th data-sortable="true" data-falign="right" data-align="right" data-formatter="numberFormatter" data-field="total">Total</th>
                                    <th data-sortable="true" data-field="pagada">Pagada</th>
                                    <th data-sortable="true" data-field="condicion">Estado</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane {if="$fsc->reporte=='reporte-ventas'"}active{/if}" id="reporte-ventas">
                    <table id="table-reporte-ventas"
                            data-mobile-responsive="true"
                            data-toggle="table"
                            data-method="GET"
                            data-height="500"
                            data-search="false"
                            {if="$fsc->reporte=='reporte-ventas'"}data-ajax="buscarInformacion"{/if}
                            data-pagination="true"
                            data-page-size="100"
                            data-page-list="[100,150,200,250,500]"
                            data-show-footer="false"
                            data-show-refresh="true"
                            data-side-pagination="server"
                            data-row-style="rowStyle">
                        <thead>
                            <tr>
                                <th colspan="11" class="text-center">Reporte de Ventas del {$fsc->fecha_inicio} al {$fsc->fecha_fin}</th>
                            </tr>
                          <tr class="text-center">
                              <th data-sortable="true" data-field="fecha" data-footer-formatter="totalTextFormatter">Fecha</th>
                              <th data-sortable="true" data-field="codalmacen">Almacén</th>
                              <th data-sortable="true" data-field="nombrecliente" data-footer-formatter="totalFormatter">Cliente</th>
                              <th data-sortable="true" data-field="cifnif">RNC</th>
                              <th data-sortable="true" data-field="ncf">NCF</th>
                              <th data-sortable="true" data-field="ncf_modifica">NCF Modifica</th>
                              <th data-sortable="true" data-field="tipo_comprobante">Tipo</th>
                              <th data-align="right" data-falign="right" data-field="neto" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Base Imponible</th>
                              <th data-align="right" data-falign="right" data-field="totaliva" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Itbis</th>
                              <th data-align="right" data-falign="right" data-field="total" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Total</th>
                              <th data-sortable="true" data-field="condicion">Estado</th>
                          </tr>
                        </thead>
                    </table>
                    <div class="row">
                        <div class="col-sm-2"><strong>Base Imponible Total</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalNeto)}</div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2"><strong>{#FS_IVA#}</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalItbis)}</div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2"><strong>Total Facturado</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalMonto)}</div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane {if="$fsc->reporte=='detalle-ventas'"}active{/if}" id="detalle-ventas">
                    <table id="table-detalle-ventas"
                            data-mobile-responsive="true"
                            data-toggle="table"
                            data-method="GET"
                            data-height="500"
                            data-search="false"
                            {if="$fsc->reporte=='detalle-ventas'"}data-ajax="buscarInformacion"{/if}
                            data-pagination="true"
                            data-page-size="100"
                            data-page-list="[100,150,200,250,500]"
                            data-show-footer="false"
                            data-show-refresh="true"
                            data-side-pagination="server">
                        <thead>
                            <tr>
                                <th colspan="10" class="text-center">Detalle de Ventas del {$fsc->fecha_inicio} al {$fsc->fecha_fin}</th>
                            </tr>
                          <tr class="text-center">
                              <th data-sortable="true" data-field="fecha" data-footer-formatter="totalTextFormatter">Fecha</th>
                              <th data-sortable="true" data-field="codalmacen">Almacén</th>
                              <th data-sortable="true" data-field="ncf">NCF</th>
                              <th data-sortable="true" data-field="documento">Documento</th>
                              <th data-sortable="true" data-field="referencia">Codigo</th>
                              <th data-sortable="true" data-field="descripcion">Descripci&oacute;n</th>
                              <th data-align="right" data-falign="right" data-field="cantidad" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Cantidad</th>
                              <th data-align="right" data-falign="right" data-field="precio" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Precio</th>
                              <th data-align="right" data-falign="right" data-field="descuento" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Dscto</th>
                              <th data-align="right" data-falign="right" data-field="monto" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Monto</th>
                          </tr>
                        </thead>
                    </table>
                    <div class="row">
                        <div class="col-sm-2"><strong>Total Cantidad</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalCantidad)}</div>
                        <div class="col-sm-8"></div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2"><strong>Total Facturado</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalMonto)}</div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane {if="$fsc->reporte=='detalle-ventas-agente'"}active{/if}" id="detalle-ventas-agente">
                    <table id="table-detalle-ventas-agente"
                            data-mobile-responsive="true"
                            data-toggle="table"
                            data-method="GET"
                            data-height="500"
                            data-search="false"
                            {if="$fsc->reporte=='detalle-ventas-agente'"}data-ajax="buscarInformacion"{/if}
                            data-pagination="true"
                            data-page-size="100"
                            data-page-list="[100,150,200,250,500]"
                            data-show-footer="false"
                            data-show-refresh="true"
                            data-side-pagination="server">
                        <thead>
                            <tr>
                                <th colspan="17" class="text-center">Detalle de Ventas por Vendedor del {$fsc->fecha_inicio} al {$fsc->fecha_fin}</th>
                            </tr>
                          <tr class="text-center">
                              <th data-sortable="true" data-field="fecha" data-footer-formatter="totalTextFormatter">Fecha</th>
                              <th data-sortable="true" data-field="codalmacen">Almacén</th>
                              <th data-sortable="true" data-field="nombre_vendedor">Vendedor</th>
                              <th data-sortable="true" data-field="grupo_cliente">Grupo de Clientes</th>
                              <th data-sortable="true" data-field="nombrecliente">Cliente</th>
                              <th data-sortable="true" data-field="cifnif">{#FS_CIFNIF#}</th>
                              <th data-sortable="true" data-field="ncf">NCF</th>
                              <th data-sortable="true" data-field="idfactura">Id Fac</th>
                              <th data-sortable="true" data-field="afecta_a">Afecta A</th>
                              <th data-sortable="true" data-field="referencia">Codigo</th>
                              <th data-sortable="true" data-field="descripcion">Descripci&oacute;n</th>
                              <th data-align="right" data-falign="right" data-field="cantidad" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Cantidad</th>
                              <th data-align="right" data-falign="right" data-field="precio" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Precio</th>
                              <th data-align="right" data-falign="right" data-field="descuento" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Dscto</th>
                              <th data-align="right" data-falign="right" data-field="monto" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Monto</th>
                              <th data-sortable="true" data-field="forma_pago">Forma Pago</th>
                              <th data-sortable="true" data-field="tipo">Tipo</th>
                          </tr>
                        </thead>
                    </table>
                    <div class="row">
                        <div class="col-sm-2"><strong>Total Cantidad</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalCantidad)}</div>
                        <div class="col-sm-8"></div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2"><strong>Total Descuento</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalDescuento)}</div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2"><strong>Total Facturado</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalMonto)}</div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane {if="$fsc->reporte=='resumen-ventas'"}active{/if}" id="resumen-ventas">
                    <table id="table-resumen-ventas"
                            data-mobile-responsive="true"
                            data-toggle="table"
                            data-method="GET"
                            data-height="500"
                            data-search="false"
                            {if="$fsc->reporte=='resumen-ventas'"}data-ajax="buscarInformacion"{/if}
                            data-pagination="true"
                            data-page-size="100"
                            data-page-list="[100,150,200,250,500,750]"
                            data-show-footer="false"
                            data-show-refresh="true"
                            data-side-pagination="server">
                        <thead>
                            <tr>
                                <th colspan="7" class="text-center">Resúmen de Ventas del {$fsc->fecha_inicio} al {$fsc->fecha_fin}</th>
                            </tr>
                            <tr class="text-center">
                                <th data-field="codalmacen" data-sortable="true">Almacén</th>
                                <th data-field="tipo_comprobante" data-sortable="true">Tipo NCF</th>
                                <th data-field="tc_descripcion" data-sortable="true">Descripci&oacute;n NCF</th>
                                <th data-field="referencia" data-sortable="true">Referencia</th>
                                <th data-field="descripcion" data-sortable="true">Descripci&oacute;n Artículo</th>
                                <th data-field="cantidad" data-align="right" data-falign="right" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Cantidad</th>
                                <th data-field="monto" data-align="right" data-falign="right" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Monto</th>
                            </tr>
                        </thead>
                    </table>
                    <div class="row">
                        <div class="col-sm-2"><strong>Total Cantidad</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalCantidad)}</div>
                        <div class="col-sm-8"></div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2"><strong>Total Facturado</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalMonto)}</div>
                    </div>                    
                </div>
                <div role="tabpanel" class="tab-pane {if="$fsc->reporte=='reporte-compras'"}active{/if}" id="reporte-compras">
                    <table id="table-reporte-compras"
                            data-mobile-responsive="true"
                            data-toggle="table"
                            data-method="GET"
                            data-height="500"
                            data-search="false"
                            {if="$fsc->reporte=='reporte-compras'"}data-ajax="buscarInformacion"{/if}
                            data-pagination="true"
                            data-page-size="100"
                            data-page-list="[100,150,200,250,500,750]"
                            data-show-footer="true"
                            data-show-refresh="true"
                            data-side-pagination="server">
                        <thead>
                            <tr>
                                <th colspan="8" class="text-center">Reporte de Compras del {$fsc->fecha_inicio} al {$fsc->fecha_fin}</th>
                            </tr>
                            <tr class="text-center">
                                <th data-field="fecha" data-sortable="true" data-footer-formatter="totalTextFormatter">Fecha</th>
                                <th data-field="codalmacen" data-sortable="true">Almacén</th>
                                <th data-field="nombre" data-sortable="true" data-footer-formatter="totalFormatter">Proveedor</th>
                                <th data-field="cifnif" data-sortable="true">RNC</th>
                                <th data-field="ncf" data-sortable="true">Factura - NCF</th>
                                <th data-field="neto" data-align="right" data-falign="right" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Base Imponible</th>
                                <th data-field="totaliva" data-align="right" data-falign="right" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Itbis</th>
                                <th data-field="total" data-align="right" data-falign="right" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Total</th>
                            </tr>
                        </thead>
                    </table>
                    <div class="row">
                        <div class="col-sm-2"><strong>Base Imponible Total</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalNeto)}</div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2"><strong>{#FS_IVA#}</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalItbis)}</div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2"><strong>Total Facturado</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalMonto)}</div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane {if="$fsc->reporte=='detalle-compras'"}active{/if}" id="detalle-compras">
                    <table id="table-detalle-compras"
                            data-mobile-responsive="true"
                            data-toggle="table"
                            data-method="GET"
                            data-height="500"
                            data-search="false"
                            {if="$fsc->reporte=='detalle-compras'"}data-ajax="buscarInformacion"{/if}
                            data-pagination="true"
                            data-page-size="100"
                            data-page-list="[100,150,200,250,500,750]"
                            data-show-footer="false"
                            data-show-refresh="true"
                            data-side-pagination="server">
                        <thead>
                            <tr>
                                <th colspan="9" class="text-center">Detalle de Compras del {$fsc->fecha_inicio} al {$fsc->fecha_fin}</th>
                            </tr>
                          <tr class="text-center">
                              <th data-field="fecha" data-sortable="true" data-footer-formatter="totalTextFormatter">Fecha</th>
                              <th data-field="codalmacen" data-sortable="true">Almacén</th>
                              <th data-field="ncf" data-sortable="true">NCF</th>
                              <th data-field="documento" data-sortable="true">Documento</th>
                              <th data-field="referencia" data-sortable="true">Codigo</th>
                              <th data-field="descripcion" data-sortable="true">Descripci&oacute;n</th>
                              <th data-field="cantidad" data-align="right" data-falign="right" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Cantidad</th>
                              <th data-field="precio" data-align="right" data-falign="right" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Precio</th>
                              <th data-field="monto" data-align="right" data-falign="right" data-formatter="numberFormatter" data-footer-formatter="sumFormatter">Monto</th>
                          </tr>
                        </thead>
                    </table>
                    <div class="row">
                        <div class="col-sm-2"><strong>Total Cantidad</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalCantidad)}</div>
                        <div class="col-sm-8"></div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2"><strong>Total Facturado</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalMonto)}</div>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane {if="$fsc->reporte=='reporte-606'"}active{/if}" id="reporte-606">
                    <table id="table-reporte-606"
                            data-mobile-responsive="true"
                            data-toggle="table"
                            data-method="GET"
                            data-height="500"
                            data-search="false"
                            {if="$fsc->reporte=='reporte-606'"}data-ajax="buscarInformacion"{/if}
                            data-pagination="true"
                            data-page-size="100"
                            data-page-list="[100,150,200,250,500,750]"
                            data-show-footer="true"
                            data-show-refresh="true"
                            data-side-pagination="server">
                        <thead>
                            <tr>
                                <th colspan="13" class="text-center">Reporte DGII 606 del {$fsc->fecha_inicio} al {$fsc->fecha_fin}</th>
                            </tr>
                            <tr class="text-center">
                                <th data-field="cifnif" data-footer-formatter="totalTextFormatter">RNC o Cédula</th>
                                <th data-field="tipo_id">Tipo Id.</th>
                                <th data-field="descripcion" data-footer-formatter="totalFormatter">Tipo Bienes o Servicios Comprados</th>
                                <th data-field="ncf">NCF</th>
                                <th data-field="ncf_modifica">NCF Modifica</th>
                                <th data-field="fechaym">Fec. NCF AAAAMM</th>
                                <th data-field="fechadd">Fec. NCF DD</th>
                                <th data-field="fechapym">Fec. Pago AAAAMM</th>
                                <th data-field="fechapdd">Fec. Pago DD</th>
                                <th data-field="totaliva" data-align="right" data-falign="right" data-footer-formatter="sumNormalFormatter">Itbis Facturado</th>
                                <th data-field="totalivaretenido" data-align="right" data-falign="right" data-footer-formatter="sumNormalFormatter">Itbis Retenido</th>
                                <th data-field="neto" data-align="right" data-falign="right" data-footer-formatter="sumNormalFormatter">Monto Facturado</th>
                                <th data-field="totalnetoretenido" data-align="right" data-falign="right" data-footer-formatter="sumNormalFormatter">Retencion Renta</th>
                            </tr>
                        </thead>
                    </table>
                    <div class="row">
                        <div class="col-sm-2"><strong>Total Documentos</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalDocumentos,0)}</div>
                        <div class="col-sm-8"></div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2"><strong>Total {#FS_IVA#}</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalItbis)}</div>
                    </div>                    
                    <div class="row">
                        <div class="col-sm-2"><strong>Total Neto</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalNeto)}</div>
                    </div>                    
                </div>
                <div role="tabpanel" class="tab-pane {if="$fsc->reporte=='reporte-607'"}active{/if}" id="reporte-607">
                    <table id="table-reporte-607"
                            data-mobile-responsive="true"
                            data-toggle="table"
                            data-method="GET"
                            data-height="500"
                            data-search="false"
                            {if="$fsc->reporte=='reporte-607'"}data-ajax="buscarInformacion"{/if}
                            data-pagination="true"
                            data-page-size="100"
                            data-page-list="[100,150,200,250,500,750]"
                            data-show-footer="false"
                            data-show-refresh="true"
                            data-side-pagination="server">
                        <thead>
                            <tr>
                                <th colspan="9" class="text-center">Reporte DGII 607 del {$fsc->fecha_inicio} al {$fsc->fecha_fin}</th>
                            </tr>
                            <tr>
                                <th data-formatter="runningFormatter">Item</th>
                                <th data-field="cifnif" data-footer-formatter="totalFormatter">RNC/Cedula</th>
                                <th data-field="tipo_id">Tipo Ident.</th>
                                <th data-field="ncf">NCF</th>
                                <th data-field="ncf_modifica">NCF Modifica</th>
                                <th data-field="fecha">Fecha</th>
                                <th data-field="totaliva" data-align="right" data-falign="right" data-footer-formatter="sumNormalFormatter">Itbis Facturado</th>
                                <th data-field="neto" data-align="right" data-falign="right" data-footer-formatter="sumNormalFormatter">Monto Facturado</th>
                                <th data-field="estado">Estado</th>
                            </tr>
                        </thead>
                    </table>
                    <div class="row">
                        <div class="col-sm-2"><strong>Total Documentos</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalDocumentos,0)}</div>
                        <div class="col-sm-8"></div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2"><strong>Total {#FS_IVA#}</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalItbis)}</div>
                    </div>                    
                    <div class="row">
                        <div class="col-sm-2"><strong>Total Neto</strong></div>
                        <div class="col-sm-2 text-right">{$fsc->show_numero($fsc->totalNeto)}</div>
                    </div>
                    <br/>
                    <div class="col-sm-6 table-responsive">
                        <table class="table table-condensed table-bordered">
                            <thead>
                                <tr>
                                    <th class="text-center">Forma de Pago</th>
                                    <th class="text-center">{#FS_IVA#}</th>
                                    <th class="text-center">Neto</th>
                                    <th class="text-center">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- {$total_neto = 0} !-->
                                <!-- {$total_iva = 0} !-->
                                <!-- {$total_general = 0} !-->
                                {loop="$fsc->total_forma_pago_dgii"}
                                <tr>
                                    <td class="col-sm-2"><strong>{$value->codpago}</strong></td>
                                    <td class="col-sm-2 text-right">{$fsc->show_numero($value->totalneto)}</td>
                                    <td class="col-sm-2 text-right">{$fsc->show_numero($value->totaliva)}</td>
                                    <td class="col-sm-2 text-right">{$fsc->show_numero(($value->totalneto+$value->totaliva))}</td>
                                    <!-- {$total_neto += $value->totalneto} !-->
                                    <!-- {$total_iva += $value->totaliva} !-->
                                    <!-- {$total_general += ($value->totalneto+$value->totaliva)} !-->
                                </tr>
                                {else}
                                <tr class="bg-warning">
                                <td colspan="4" class="text-center">No hay información de las formas de pago</td>
                                </tr>
                                {/loop}
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th>Total</th>
                                    <th class="col-sm-2 text-right">{$fsc->show_numero($total_neto)}</th>
                                    <th class="col-sm-2 text-right">{$fsc->show_numero($total_iva)}</th>
                                    <th class="col-sm-2 text-right">{$fsc->show_numero($total_general)}</th>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
                <div role="tabpanel" class="tab-pane {if="$fsc->reporte=='reporte-608'"}active{/if}" id="reporte-608">
                    <table id="table-reporte-608"
                            data-mobile-responsive="true"
                            data-toggle="table"
                            data-method="GET"
                            data-height="500"
                            data-search="false"
                            {if="$fsc->reporte=='reporte-608'"}data-ajax="buscarInformacion"{/if}
                            data-pagination="true"
                            data-page-size="100"
                            data-page-list="[100,150,200,250,500,750]"
                            data-show-footer="true"
                            data-show-refresh="true"
                            data-side-pagination="server">
                        <thead>
                            <tr>
                                <th colspan="4" class="text-center">Reporte DGII 608 del {$fsc->fecha_inicio} al {$fsc->fecha_fin}</th>
                            </tr>
                            <tr>
                                <th data-field="ncf" data-footer-formatter="totalTextFormatter">NCF</th>
                                <th data-field="fecha" data-footer-formatter="totalFormatter">Fecha</th>
                                <th data-field="motivo">Tipo de Anulación</th>
                                <th data-field="estado">Estado</th>
                            </tr>
                        </thead>
                    </table>
                </div>
            </div>
          </div>
      </div>
    </div>
</div>
<div id="modal_ayuda" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">Ayuda de Informes Fiscales</h4>
      </div>
      <div class="modal-body">
        <p>En esta ventana se generan los distintos reportes contables necesarios para presentar a impuestos internos</p>
        <div class="media">
            <div class="media-left">
                <img class="media-object" src="plugins/republica_dominicana/view/ayuda/lista_reportes.png" alt="Lista de Reportes">
            </div>
            <div class="media-body">
              <h4 class="media-heading">Lista de Reportes</h4>
              <p align="justify">
                  Al lado izquiero de la pantalla tenemos el listado de reportes que se pueden generar.<br />
                  Cada reporte genera informaci&oacute;n que muestra distintos campos dependiendo si son reportes de caracter legal para
                  entregar a la DGII o si son reportes de caracter verificador como los Reportes de Ventas, Reportes de Compras y Reporte Consolidado.<br />
                  El uso de estos reportes es de la siguiente manera:<br />
              <ol>
                  <li>Seleccionar dando un click al reporte elegido.</li>
                  <li>Escoger el rango de fechas para obtener la informaci&oacute;n.</li>
                  <li>Darle click al boton <b>Generar Informaci&oacute;n</b></li>
                  <li>Cuando recargue la página, si necesitamos descargar el reporte, al inicio del mismo al lado derecho hay un boton al que si le damos click
                  nos indicará los distintos formatos en los que podemos descargar el mismo.</li>
                  <li>Para generar otro reporte, debemos repetir los pasos anteriores.</li>
              </ol>
              </p>
            </div>
          </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar Ventana</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<script>
    $.fn.selectpicker.defaults = {
        selectAllText: 'Marcar Todo',
        deselectAllText: 'Desmarcar',
        noneSelectedText: 'Nada Seleccionado',
        countSelectedText: "{0} de {1} marcados",
        selectedTextFormat: 'count'
    };

    function runningFormatter(value, row, index) {
        return index;
    }

    function totalFormatter(data) {
        return data.length + ' Documentos';
    }

    function totalTextFormatter(data) {
        return 'Total';
    }

    function numberFormatter(value, row, index) {
        return parseFloat(value).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
    }

    function sumFormatter(data) {
        field = this.field;
        return parseFloat(data.reduce(function(sum, row) {
            return sum + (+row[field]);
        }, 0)).toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
    }

    function sumNormalFormatter(data) {
        field = this.field;
        return parseFloat(data.reduce(function(sum, row) {
            return sum + (+row[field]);
        }, 0)).toFixed(2);
    }

    function seleccionar(reporte){
        $('#tipo-reporte').val(reporte);
    }

    $(window).resize(function() {
        $('#table-{$fsc->reporte}').bootstrapTable('resetView');
    });

    $('#ayuda-informes-fiscales').click(function(event) {
        event.preventDefault();
        $('#modal_ayuda').modal('show');
     });

    var $table = $('#table-{$fsc->reporte}');
    $table.bootstrapTable('refreshOptions', {
        exportDataType: 'all'
    });

    $('#inicio').datepicker('update', '{$fsc->fecha_inicio}');
    $('#fin').datepicker('update', '{$fsc->fecha_fin}');

    function responseHandler(res) {
        return res;
    }

    function rowStyle(row, index) {
        var classes = ['active', 'success', 'info', 'warning', 'danger'];
        if (row.estado==='f') {
            return {
                classes: 'danger'
            };
        }
        return {};
    }

    function runningFormatter(value, row, index) {
        var tableOptions = $('#table-{$fsc->reporte}').bootstrapTable('getOptions');
        return ((tableOptions.pageNumber-1) * tableOptions.pageSize)+(1 + index);
    }

    function buscarInformacion(params){
        var search = (params.data.search!=='undefined')?params.data.search:'';
        var sort = (params.data.sort!=='undefined')?params.data.sort:'';
        var order = (params.data.order!=='undefined')?params.data.order:'';
        $.ajax({
            type: "GET",
            url: "{$fsc->url()}",
            data: "tabla_reporte={$fsc->reporte}&"+$("#f_informes_fiscales").serialize()+'&offset='+params.data.offset+'&limit='+params.data.limit+'&search='+search+'&sort='+sort+'&order='+order,
            dataType: "json",
            success: function (data) {
                setTimeout(function() {
                    params.success({
                        total: data.total,
                        rows: data.rows
                    });
                }, 1000);

            },
            error: function (er) {
                params.error(er);
            }
        });
    }
</script>
{include="footer"}